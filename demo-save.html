<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Save Demo - Resources & Blogs</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0f0;
            padding: 2rem;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #0f0;
            margin-bottom: 2rem;
            text-align: center;
            text-shadow: 0 0 10px #0f0;
        }
        
        .status-bar {
            background: #111;
            border: 1px solid #0f0;
            padding: 1rem;
            margin-bottom: 2rem;
            border-radius: 5px;
        }
        
        .demo-section {
            background: #111;
            border: 1px solid #0f0;
            padding: 2rem;
            margin-bottom: 2rem;
            border-radius: 5px;
        }
        
        h2 {
            color: #0f0;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #0f0;
            padding-bottom: 0.5rem;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .demo-panel {
            background: #000;
            border: 1px solid #0f0;
            padding: 1.5rem;
            border-radius: 5px;
        }
        
        .demo-panel h3 {
            color: #0f0;
            margin-bottom: 1rem;
        }
        
        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            cursor: pointer;
            margin: 0.5rem;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            border-radius: 3px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #0a0;
            box-shadow: 0 0 10px #0f0;
        }
        
        button:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
        }
        
        .result-box {
            background: #000;
            border: 1px solid #0f0;
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 3px;
            white-space: pre-wrap;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .success {
            color: #0f0;
            border-color: #0f0;
        }
        
        .error {
            color: #f00;
            border-color: #f00;
        }
        
        .warning {
            color: #ff0;
            border-color: #ff0;
        }
        
        .data-list {
            margin-top: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .data-item {
            background: #111;
            border: 1px solid #0f0;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 3px;
        }
        
        .data-item h4 {
            color: #0f0;
            margin-bottom: 0.5rem;
        }
        
        .data-item p {
            color: #0a0;
            font-size: 0.9rem;
        }
        
        .timestamp {
            color: #666;
            font-size: 0.8rem;
        }
        
        .loading {
            display: inline-block;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Save Demo - Resources & Blogs</h1>
        
        <!-- Connection Status -->
        <div class="status-bar">
            <h3>Connection Status</h3>
            <div id="connection-info">Checking connection...</div>
        </div>
        
        <!-- Resources Demo -->
        <div class="demo-section">
            <h2>üìö Resources Demo</h2>
            
            <div class="demo-grid">
                <div class="demo-panel">
                    <h3>Save New Resources</h3>
                    <button onclick="saveTestResource()">üíæ Save Test Resource</button>
                    <button onclick="saveBatchResources()">üì¶ Save 5 Resources</button>
                    <button onclick="saveAIResource()">ü§ñ Save AI Resource</button>
                    <div id="resource-save-result" class="result-box"></div>
                </div>
                
                <div class="demo-panel">
                    <h3>Load Resources</h3>
                    <button onclick="loadResources()">üîÑ Load All Resources</button>
                    <button onclick="clearResourceDisplay()">üóëÔ∏è Clear Display</button>
                    <div id="resource-list" class="data-list"></div>
                </div>
            </div>
        </div>
        
        <!-- Blogs Demo -->
        <div class="demo-section">
            <h2>üìù Blogs Demo</h2>
            
            <div class="demo-grid">
                <div class="demo-panel">
                    <h3>Save New Blogs</h3>
                    <button onclick="saveTestBlog()">üíæ Save Test Blog</button>
                    <button onclick="saveTechBlog()">üíª Save Tech Blog</button>
                    <button onclick="saveStartupBlog()">üöÄ Save Startup Blog</button>
                    <div id="blog-save-result" class="result-box"></div>
                </div>
                
                <div class="demo-panel">
                    <h3>Load Blogs</h3>
                    <button onclick="loadBlogs()">üîÑ Load All Blogs</button>
                    <button onclick="clearBlogDisplay()">üóëÔ∏è Clear Display</button>
                    <div id="blog-list" class="data-list"></div>
                </div>
            </div>
        </div>
        
        <!-- Storage Info -->
        <div class="demo-section">
            <h2>üíæ Storage Information</h2>
            <button onclick="showStorageInfo()">üìä Show Storage Details</button>
            <button onclick="clearLocalStorage()">‚ö†Ô∏è Clear LocalStorage</button>
            <button onclick="exportData()">üì• Export All Data</button>
            <div id="storage-info" class="result-box"></div>
        </div>
    </div>
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase.js"></script>
    
    <script>
        // Utility functions
        function log(elementId, message, type = 'success') {
            const element = document.getElementById(elementId);
            element.className = `result-box ${type}`;
            element.textContent = message;
        }
        
        function formatDate(date) {
            return new Date(date).toLocaleString();
        }
        
        // Check connection status on load
        window.addEventListener('load', async () => {
            checkConnectionStatus();
            // Auto-load data
            loadResources();
            loadBlogs();
        });
        
        async function checkConnectionStatus() {
            const infoDiv = document.getElementById('connection-info');
            const status = db.getConnectionStatus();
            
            if (status.status === 'connected') {
                infoDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Connected to Supabase Backend
                        <br>URL: ${SUPABASE_URL}
                        <br>Status: Cloud storage active
                    </div>
                `;
            } else if (status.status === 'initializing') {
                infoDiv.innerHTML = `
                    <div class="warning">
                        ‚è≥ Initializing connection...
                    </div>
                `;
                setTimeout(checkConnectionStatus, 1000);
            } else {
                infoDiv.innerHTML = `
                    <div class="error">
                        ‚ö†Ô∏è Using LocalStorage Fallback
                        <br>Reason: ${status.error || 'Supabase unavailable'}
                        <br>Data will be saved locally only
                    </div>
                `;
            }
        }
        
        // Resource Functions
        async function saveTestResource() {
            try {
                const resource = {
                    name: `Test Resource ${Date.now()}`,
                    url: 'https://example.com/resource',
                    description: 'This is a test resource saved at ' + new Date().toISOString() + '. Tags: test, demo, example',
                    category: 'testing',
                    featured: false
                };
                
                console.log('Saving resource:', resource);
                const result = await db.createResource(resource);
                
                if (result.error) {
                    log('resource-save-result', `‚ùå Error: ${result.error.message}`, 'error');
                } else {
                    log('resource-save-result', 
                        `‚úÖ Resource saved successfully!\nID: ${result.data.id}\nTitle: ${result.data.title}`, 
                        'success');
                    // Reload resources
                    loadResources();
                }
            } catch (error) {
                log('resource-save-result', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function saveBatchResources() {
            try {
                const resources = [
                    {
                        name: 'How to Start a Lean AI Startup',
                        url: 'https://henrythe9th.substack.com/p/how-to-start-a-lean-ai-native-startup',
                        description: 'Guide on building AI-native startups with minimal resources. Tags: ai, startup, lean',
                        category: 'startups',
                        featured: true
                    },
                    {
                        name: 'React 18 Documentation',
                        url: 'https://react.dev',
                        description: 'Official React documentation and tutorials. Tags: react, javascript, frontend',
                        category: 'documentation',
                        featured: false
                    },
                    {
                        name: 'Supabase Quickstart',
                        url: 'https://supabase.com/docs/guides/getting-started',
                        description: 'Get started with Supabase in minutes. Tags: supabase, database, backend',
                        category: 'backend',
                        featured: false
                    },
                    {
                        name: 'TailwindCSS Components',
                        url: 'https://tailwindui.com',
                        description: 'Beautiful UI components built with Tailwind. Tags: css, tailwind, ui',
                        category: 'design',
                        featured: false
                    },
                    {
                        name: 'GitHub Copilot',
                        url: 'https://github.com/features/copilot',
                        description: 'AI pair programmer for faster coding. Tags: ai, coding, productivity',
                        category: 'tools',
                        featured: false
                    }
                ];
                
                let savedCount = 0;
                for (const resource of resources) {
                    const result = await db.createResource(resource);
                    if (!result.error) savedCount++;
                }
                
                log('resource-save-result', 
                    `‚úÖ Batch save complete!\nSaved ${savedCount}/${resources.length} resources`, 
                    'success');
                loadResources();
            } catch (error) {
                log('resource-save-result', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function saveAIResource() {
            try {
                const resource = {
                    name: 'Claude AI Assistant',
                    url: 'https://claude.ai',
                    description: 'Advanced AI assistant for coding, writing, analysis. Rating: 5/5 - Highly recommended. Tags: ai, claude, assistant, productivity',
                    category: 'ai-tools',
                    featured: true
                };
                
                const result = await db.createResource(resource);
                
                if (result.error) {
                    log('resource-save-result', `‚ùå Error: ${result.error.message}`, 'error');
                } else {
                    log('resource-save-result', 
                        `‚úÖ AI Resource saved!\nTitle: ${result.data.title}`, 
                        'success');
                    loadResources();
                }
            } catch (error) {
                log('resource-save-result', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function loadResources() {
            try {
                const result = await db.getResources();
                const listDiv = document.getElementById('resource-list');
                
                if (result.error) {
                    listDiv.innerHTML = `<div class="error">Error loading resources: ${result.error.message}</div>`;
                    return;
                }
                
                const resources = result.data || [];
                
                if (resources.length === 0) {
                    listDiv.innerHTML = '<div class="warning">No resources found. Click save buttons to add some!</div>';
                    return;
                }
                
                listDiv.innerHTML = resources.map(resource => `
                    <div class="data-item">
                        <h4>üìö ${resource.name}</h4>
                        <p>üîó ${resource.url}</p>
                        <p>üìù ${resource.description}</p>
                        <p>üìÇ Category: ${resource.category}</p>
                        <p>‚≠ê Featured: ${resource.featured ? '‚úÖ Yes' : '‚ùå No'}</p>
                        <p class="timestamp">‚è∞ ${formatDate(resource.created_at)}</p>
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('resource-list').innerHTML = 
                    `<div class="error">Error: ${error.message}</div>`;
            }
        }
        
        function clearResourceDisplay() {
            document.getElementById('resource-list').innerHTML = '';
            document.getElementById('resource-save-result').textContent = '';
        }
        
        // Blog Functions
        async function saveTestBlog() {
            try {
                const blog = {
                    title: `Test Blog Post ${Date.now()}`,
                    slug: `test-blog-${Date.now()}`,
                    content: `# Test Blog Post\n\nThis is a test blog post created at ${new Date().toISOString()}\n\n## Features\n- Markdown support\n- Auto-generated slug\n- Tagged content\n\n## Conclusion\nThis demonstrates the blog saving functionality.`,
                    tags: ['test', 'demo'],
                    published: true
                };
                
                console.log('Saving blog:', blog);
                const result = await db.createBlog(blog);
                
                if (result.error) {
                    log('blog-save-result', `‚ùå Error: ${result.error.message}`, 'error');
                } else {
                    log('blog-save-result', 
                        `‚úÖ Blog saved successfully!\nID: ${result.data.id}\nSlug: ${result.data.slug}`, 
                        'success');
                    loadBlogs();
                }
            } catch (error) {
                log('blog-save-result', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function saveTechBlog() {
            try {
                const blog = {
                    title: 'Building Modern Web Apps with Supabase',
                    slug: 'modern-web-apps-supabase',
                    content: `# Building Modern Web Apps with Supabase\n\nSupabase provides a complete backend solution for modern web applications.\n\n## Key Features\n\n1. **Database**: PostgreSQL with real-time subscriptions\n2. **Authentication**: Built-in auth with social providers\n3. **Storage**: File storage with CDN\n4. **Edge Functions**: Serverless computing\n\n## Getting Started\n\nStart by creating a project at supabase.com and follow the quickstart guide.\n\n## Benefits\n\n- Open source alternative to Firebase\n- SQL database with full power of PostgreSQL\n- Real-time subscriptions out of the box\n- Generous free tier\n\n## Conclusion\n\nSupabase accelerates development while giving you full control over your data.`,
                    tags: ['supabase', 'backend', 'database', 'tutorial'],
                    published: true
                };
                
                const result = await db.createBlog(blog);
                
                if (result.error) {
                    log('blog-save-result', `‚ùå Error: ${result.error.message}`, 'error');
                } else {
                    log('blog-save-result', 
                        `‚úÖ Tech blog saved!\nTitle: ${result.data.title}`, 
                        'success');
                    loadBlogs();
                }
            } catch (error) {
                log('blog-save-result', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function saveStartupBlog() {
            try {
                const blog = {
                    title: '10 Lessons from Building a Startup',
                    slug: 'startup-lessons-2024',
                    content: `# 10 Lessons from Building a Startup\n\n## 1. Start Small\nMVP first, features later.\n\n## 2. Talk to Users\nCustomer feedback is gold.\n\n## 3. Move Fast\nSpeed beats perfection in early stages.\n\n## 4. Focus on Revenue\nRevenue validates your idea.\n\n## 5. Build a Team\nGreat team > great idea.\n\n## 6. Stay Lean\nBootstrap as long as possible.\n\n## 7. Learn Constantly\nEvery failure is a lesson.\n\n## 8. Network Actively\nYour network is your net worth.\n\n## 9. Prioritize Ruthlessly\nSay no to most things.\n\n## 10. Never Give Up\nPersistence is the key to success.`,
                    tags: ['startup', 'entrepreneurship', 'business', 'lessons'],
                    published: true
                };
                
                const result = await db.createBlog(blog);
                
                if (result.error) {
                    log('blog-save-result', `‚ùå Error: ${result.error.message}`, 'error');
                } else {
                    log('blog-save-result', 
                        `‚úÖ Startup blog saved!\nTitle: ${result.data.title}`, 
                        'success');
                    loadBlogs();
                }
            } catch (error) {
                log('blog-save-result', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function loadBlogs() {
            try {
                const result = await db.getBlogs();
                const listDiv = document.getElementById('blog-list');
                
                if (result.error) {
                    listDiv.innerHTML = `<div class="error">Error loading blogs: ${result.error.message}</div>`;
                    return;
                }
                
                const blogs = result.data || [];
                
                if (blogs.length === 0) {
                    listDiv.innerHTML = '<div class="warning">No blogs found. Click save buttons to add some!</div>';
                    return;
                }
                
                listDiv.innerHTML = blogs.map(blog => `
                    <div class="data-item">
                        <h4>üìù ${blog.title}</h4>
                        <p>üîó Slug: ${blog.slug}</p>
                        <p>üè∑Ô∏è ${blog.tags ? blog.tags.join(', ') : 'No tags'}</p>
                        <p>üìä Status: ${blog.published ? '‚úÖ Published' : 'üìù Draft'}</p>
                        <p class="timestamp">‚è∞ ${formatDate(blog.created_at)}</p>
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('blog-list').innerHTML = 
                    `<div class="error">Error: ${error.message}</div>`;
            }
        }
        
        function clearBlogDisplay() {
            document.getElementById('blog-list').innerHTML = '';
            document.getElementById('blog-save-result').textContent = '';
        }
        
        // Storage Functions
        async function showStorageInfo() {
            try {
                const status = db.getConnectionStatus();
                const localData = {
                    resources: localStorage.getItem('resources') ? JSON.parse(localStorage.getItem('resources')).length : 0,
                    blogs: localStorage.getItem('blogs') ? JSON.parse(localStorage.getItem('blogs')).length : 0,
                    profile: localStorage.getItem('profile') ? 'Yes' : 'No',
                    totalSize: new Blob([JSON.stringify(localStorage)]).size
                };
                
                const info = `
üìä Storage Information
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Connection Status: ${status.status}
Storage Mode: ${status.usingFallback ? 'LocalStorage' : 'Supabase + LocalStorage'}

LocalStorage Data:
- Resources: ${localData.resources} items
- Blogs: ${localData.blogs} items  
- Profile: ${localData.profile}
- Total Size: ${(localData.totalSize / 1024).toFixed(2)} KB

Storage Keys:
${Object.keys(localStorage).map(key => `- ${key}`).join('\n')}

${status.status === 'connected' ? '‚úÖ Data syncs to Supabase' : '‚ö†Ô∏è Data stored locally only'}
                `;
                
                log('storage-info', info, 'success');
            } catch (error) {
                log('storage-info', `Error: ${error.message}`, 'error');
            }
        }
        
        function clearLocalStorage() {
            if (confirm('‚ö†Ô∏è This will clear ALL localStorage data. Are you sure?')) {
                localStorage.clear();
                log('storage-info', '‚úÖ LocalStorage cleared successfully', 'success');
                loadResources();
                loadBlogs();
            }
        }
        
        async function exportData() {
            try {
                const resources = await db.getResources();
                const blogs = await db.getBlogs();
                
                const exportData = {
                    exportDate: new Date().toISOString(),
                    connectionStatus: db.getConnectionStatus(),
                    data: {
                        resources: resources.data || [],
                        blogs: blogs.data || []
                    }
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `portfolio-export-${Date.now()}.json`;
                a.click();
                
                log('storage-info', '‚úÖ Data exported successfully', 'success');
            } catch (error) {
                log('storage-info', `Export failed: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>