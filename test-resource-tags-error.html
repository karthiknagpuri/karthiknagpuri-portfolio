<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Resource Tags Error</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        .test {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
        }
        .success {
            color: #00ff00;
        }
        .error {
            color: #ff0000;
        }
        button {
            background: #333;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 10px 20px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #444;
        }
    </style>
</head>
<body>
    <h1>Resource Tags Error Tester</h1>
    
    <div id="output"></div>
    
    <div>
        <button onclick="testGetResources()">Test Get Resources</button>
        <button onclick="testCreateResource()">Test Create Resource</button>
        <button onclick="testCreateWithTags()">Test Create With Tags (Should Fail)</button>
        <button onclick="testDirectSupabase()">Test Direct Supabase Query</button>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        
        const SUPABASE_URL = 'https://dwbdpleelicqwhydzylr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR3YmRwbGVlbGljcXdoeWR6eWxyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczMjc4MTUsImV4cCI6MjA3MjkwMzgxNX0.hqlIpI92OIioZRLV6kAPMtfpSPinNIP4i1t5ImtOVOo';
        
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const output = document.getElementById('output');
        
        function log(message, isError = false) {
            const div = document.createElement('div');
            div.className = isError ? 'error' : 'success';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(div);
            console.log(message);
        }
        
        window.testGetResources = async function() {
            log('Testing: Get Resources...');
            try {
                const { data, error } = await supabase
                    .from('resources')
                    .select('*')
                    .limit(5);
                    
                if (error) {
                    log(`âŒ Error: ${error.message}`, true);
                    log(`Error code: ${error.code}`, true);
                    log(`Error details: ${JSON.stringify(error)}`, true);
                } else {
                    log(`âœ… Success! Got ${data?.length || 0} resources`);
                    if (data && data.length > 0) {
                        log(`First resource columns: ${Object.keys(data[0]).join(', ')}`);
                    }
                }
            } catch (err) {
                log(`âŒ Exception: ${err.message}`, true);
            }
        }
        
        window.testCreateResource = async function() {
            log('Testing: Create Resource (valid fields only)...');
            try {
                const resource = {
                    name: 'Test Resource ' + Date.now(),
                    url: 'https://example.com/test',
                    description: 'Testing resource creation',
                    category: 'testing',
                    featured: false
                };
                
                const { data, error } = await supabase
                    .from('resources')
                    .insert(resource)
                    .select();
                    
                if (error) {
                    log(`âŒ Error: ${error.message}`, true);
                    log(`Error code: ${error.code}`, true);
                } else {
                    log(`âœ… Success! Created resource with ID: ${data[0].id}`);
                    // Clean up
                    await supabase.from('resources').delete().eq('id', data[0].id);
                    log('ðŸ§¹ Cleaned up test resource');
                }
            } catch (err) {
                log(`âŒ Exception: ${err.message}`, true);
            }
        }
        
        window.testCreateWithTags = async function() {
            log('Testing: Create Resource WITH tags field (should be filtered)...');
            try {
                const resource = {
                    name: 'Test Resource With Tags ' + Date.now(),
                    url: 'https://example.com/test-tags',
                    description: 'Testing with tags field',
                    category: 'testing',
                    tags: ['test', 'should-not-work'], // This should cause error or be ignored
                    featured: false
                };
                
                const { data, error } = await supabase
                    .from('resources')
                    .insert(resource)
                    .select();
                    
                if (error) {
                    log(`âš ï¸ Expected error: ${error.message}`, true);
                    log(`This is expected - resources table doesn't have tags column`, true);
                } else {
                    log(`âš ï¸ Unexpected success - tags were ignored`);
                    if (data && data[0]) {
                        log(`Created resource columns: ${Object.keys(data[0]).join(', ')}`);
                        // Clean up
                        await supabase.from('resources').delete().eq('id', data[0].id);
                        log('ðŸ§¹ Cleaned up test resource');
                    }
                }
            } catch (err) {
                log(`âŒ Exception: ${err.message}`, true);
            }
        }
        
        window.testDirectSupabase = async function() {
            log('Testing: Direct Supabase query with specific columns...');
            try {
                // Test selecting only specific columns
                const { data, error } = await supabase
                    .from('resources')
                    .select('id, name, url, category, description, featured')
                    .limit(3);
                    
                if (error) {
                    log(`âŒ Error: ${error.message}`, true);
                } else {
                    log(`âœ… Success! Got ${data?.length || 0} resources with specific columns`);
                    if (data && data.length > 0) {
                        log(`Columns returned: ${Object.keys(data[0]).join(', ')}`);
                    }
                }
            } catch (err) {
                log(`âŒ Exception: ${err.message}`, true);
            }
        }
        
        // Auto-run basic test on load
        window.addEventListener('load', () => {
            log('Page loaded. Click buttons to run tests.');
        });
    </script>
</body>
</html>