<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Fixes</title>
    <style>
        body {
            font-family: monospace;
            padding: 2rem;
            background: #000;
            color: #0f0;
        }
        .check {
            margin: 1rem 0;
            padding: 1rem;
            border: 1px solid #0f0;
        }
        .pass { color: #0f0; }
        .fail { color: #f00; }
        .info { color: #ff0; }
        iframe {
            width: 100%;
            height: 500px;
            border: 2px solid #0f0;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <h1>Verification Report</h1>
    
    <div class="check">
        <h2>1. Navigation Check</h2>
        <div id="nav-check"></div>
    </div>
    
    <div class="check">
        <h2>2. Games.html Check</h2>
        <div id="games-check"></div>
    </div>
    
    <div class="check">
        <h2>3. Admin Panel Check</h2>
        <iframe src="/admin.html" id="admin-frame"></iframe>
        <div id="admin-check"></div>
    </div>
    
    <div class="check">
        <h2>4. Service Worker Check</h2>
        <div id="sw-check"></div>
    </div>

    <script>
        // Check navigation on all pages
        async function checkNavigation() {
            const pages = ['/', '/blog.html', '/resources.html', '/admin.html'];
            const results = [];
            
            for (const page of pages) {
                try {
                    const response = await fetch(page);
                    const html = await response.text();
                    
                    const hasGames = html.includes('href="/games.html"');
                    const hasResources = html.includes('href="/resources.html"');
                    
                    results.push({
                        page,
                        hasGames,
                        hasResources,
                        pass: !hasGames && hasResources
                    });
                } catch (error) {
                    results.push({ page, error: error.message });
                }
            }
            
            const navDiv = document.getElementById('nav-check');
            results.forEach(r => {
                const status = r.pass ? 'pass' : 'fail';
                navDiv.innerHTML += `<div class="${status}">
                    ${r.page}: Games=${r.hasGames ? 'YES ❌' : 'NO ✅'}, Resources=${r.hasResources ? 'YES ✅' : 'NO ❌'}
                </div>`;
            });
        }
        
        // Check if games.html exists
        async function checkGamesPage() {
            const div = document.getElementById('games-check');
            try {
                const response = await fetch('/games.html');
                if (response.status === 404) {
                    div.innerHTML = '<div class="pass">✅ games.html is deleted (404)</div>';
                } else {
                    div.innerHTML = '<div class="fail">❌ games.html still exists!</div>';
                }
            } catch (error) {
                div.innerHTML = '<div class="info">Error checking: ' + error.message + '</div>';
            }
        }
        
        // Check service worker
        async function checkServiceWorker() {
            const div = document.getElementById('sw-check');
            try {
                const response = await fetch('/sw.js');
                const text = await response.text();
                
                const hasGames = text.includes('games.html');
                const cacheVersion = text.match(/CACHE_NAME = '([^']+)'/)?.[1];
                
                div.innerHTML = `
                    <div class="${hasGames ? 'fail' : 'pass'}">
                        Cache Version: ${cacheVersion}
                    </div>
                    <div class="${hasGames ? 'fail' : 'pass'}">
                        References games.html: ${hasGames ? 'YES ❌' : 'NO ✅'}
                    </div>
                `;
                
                // Clear old cache
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    for (const name of cacheNames) {
                        if (name !== cacheVersion) {
                            await caches.delete(name);
                            div.innerHTML += `<div class="info">Deleted old cache: ${name}</div>`;
                        }
                    }
                }
            } catch (error) {
                div.innerHTML = '<div class="info">Error: ' + error.message + '</div>';
            }
        }
        
        // Check admin panel
        function checkAdminPanel() {
            const div = document.getElementById('admin-check');
            
            setTimeout(() => {
                try {
                    const iframe = document.getElementById('admin-frame');
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    
                    const hasAddButton = iframeDoc.getElementById('add-resource-btn') !== null;
                    const hasSettingsForm = iframeDoc.getElementById('settings-form') !== null;
                    
                    div.innerHTML = `
                        <div class="${hasAddButton ? 'pass' : 'fail'}">
                            Add Resource Button: ${hasAddButton ? 'EXISTS ✅' : 'MISSING ❌'}
                        </div>
                        <div class="${hasSettingsForm ? 'pass' : 'fail'}">
                            Settings Form: ${hasSettingsForm ? 'EXISTS ✅' : 'MISSING ❌'}
                        </div>
                    `;
                } catch (error) {
                    div.innerHTML = '<div class="info">Cannot access iframe content (expected for security)</div>';
                }
            }, 2000);
        }
        
        // Run all checks
        checkNavigation();
        checkGamesPage();
        checkServiceWorker();
        checkAdminPanel();
        
        // Force clear cache
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(registrations => {
                registrations.forEach(registration => {
                    registration.update();
                });
            });
        }
    </script>
</body>
</html>